<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>Securing SUSE Linux Enterprise Micro Using Keylime</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Securing SUSE Linux Enterprise Micro Using Keylime"/>
<meta name="description" content="Securing a machine using a TPM-based remote attestation framework—Keylime."/>
<meta name="book-title" content="Securing SUSE Linux Enterprise Micro Using Keylime"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="jsindelarova@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE Linux Enterprise Micro 6.0"/>
<meta name="publisher" content="SUSE"/><meta name="DC.creator" content="jsindelarova@suse.com"/><meta property="og:title" content="Securing SUSE Linux Enterprise Micro using Keylime"/>
<meta property="og:description" content="Securing SUSE Linux Enterprise Micro using Keylime"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Securing SUSE Linux Enterprise Micro using Keylime"/>
<meta name="twitter:description" content="Securing SUSE Linux Enterprise Micro using Keylime"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Securing SUSE Linux Enterprise Micro using Keylime",
  
    "description": "Securing a machine using a TPM-based remote attestation framework—Keylime.",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-11-14T00:00+02:00",
      
    "datePublished": "2024-11-14T00:00+02:00",
      

    "about": [
      {
        "@type": "Thing",
        "name": "Configuration"
      },
      {
        "@type": "Thing",
        "name": "Security"
      }
    ],
  
    "mentions": [
      
      { "@type": "SoftwareApplication",
        "name": "SUSE Linux Enterprise Micro",
        "softwareVersion": "6.0",
        "applicationCategory": "Operating System",
        "operatingSystem": "Linux",
        "processorRequirements": "AMD64/Intel 64"
        
      }
      
    ],
    
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="next" href="doc-gfdl-license.html" title="A. GNU Free Documentation License"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Securing SUSE Linux Enterprise Micro Using Keylime</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Securing <span class="phrase"><span class="phrase">SUSE Linux Enterprise Micro</span></span> Using Keylime</div> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="article" id="keylime-security" data-id-title="Securing SUSE Linux Enterprise Micro Using Keylime"><div class="titlepage"><div><div><h1 class="title">Securing <span class="phrase"><span class="phrase">SUSE Linux Enterprise Micro</span></span> Using Keylime</h1></div><div class="date"><span class="imprint-label">Publication Date: </span>17 Oct 2024</div><div><div class="abstract"><div class="variablelist"><dl class="variablelist"><dt id="id-1.1.12.1.1"><span class="term">WHAT?</span></dt><dd><p>
              Keylime is a TPM-based remote boot attestation and runtime integrity measurement.
            </p></dd><dt id="id-1.1.12.1.2"><span class="term">WHY?</span></dt><dd><p>
              The article describes how to configure and run Keylime on <span class="phrase"><span class="phrase">SLE Micro</span></span>.
            </p></dd><dt id="id-1.1.12.1.3"><span class="term">EFFORT</span></dt><dd><p>
                It takes approximately 25 minutes to read the article.
              </p></dd><dt id="id-1.1.12.1.4"><span class="term">GOAL</span></dt><dd><p>
                You will know more about Keylime—how it works, how you should configure it
                and how it is run.
              </p></dd><dt id="id-1.1.12.1.5"><span class="term">REQUIREMENTS</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
                    A running instance of <span class="phrase"><span class="phrase">SLE Micro</span></span>
                  </p></li></ul></div></dd></dl></div></div></div><div><div class="titlepage-revhistory"><a aria-label="Revision History" hreflang="en" href="rh-keylime-security.html" target="_blank">Revision History: Securing SUSE Linux Enterprise Micro Using Keylime</a></div></div></div></div><section xml:lang="en" class="sect1" id="keylime-remote-attestation" data-id-title="Remote attestation using Keylime"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Remote attestation using Keylime</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-remote-attestation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div><div><div class="abstract"><p>
        With the growing demand on securing devices against unauthorized
        changes, the use of the security mechanism called <span class="emphasis"><em>remote
        attestation (RA)</em></span> has been experiencing significant growth.
        Using RA, a host (client) can authenticate its boot chain status and
        running software on a remote host (verifier). RA is often combined with
        public-key encryption (using TPM2), thus the sent information can only
        be read by the services that requested the attestation, and the
        validity of the data can be verified.
      </p><p>
        Remote attestation on <span class="phrase"><span class="phrase">SLE Micro</span></span> is implemented by
        <span class="emphasis"><em>Keylime</em></span>.
      </p></div></div></div></div><section class="sect2" id="keylime-terminology" data-id-title="Terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">1.1 </span><span class="title-name">Terminology</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-terminology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      Remote attestation technology uses the following terms:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.2.2.3.1"><span class="term">Attestation key (AK)</span></dt><dd><p>
            A data signing key that proves that the data comes from a real TPM
            and has not been tampered with.
          </p></dd><dt id="id-1.2.2.3.2"><span class="term">Core root of trust for measurement</span></dt><dd><p>
            Calculates its own hash and the hash of the next step in the boot process, initiating the chain of measurements.
          </p></dd><dt id="id-1.2.2.3.3"><span class="term">Endorsement key (EK)</span></dt><dd><p>
            An encryption key that is permanently embedded in the TPM when it
            is manufactured. The public part of the key and the certification
            stored in the TPM are used to recognize a genuine TPM.
          </p></dd><dt id="id-1.2.2.3.4"><span class="term">Integrity management architecture (IMA)</span></dt><dd><p>
            A kernel integrity subsystem that provides a means of detecting
            malicious changes to files.
          </p></dd><dt id="id-1.2.2.3.5"><span class="term">Measured boot</span></dt><dd><p>
            A method with which each component in the booting sequence
            calculates a hash of the next one before delegating the execution
            of the next component. The hash extends one or several PCRs of the
            TPM. An event is created with the information about where the
            measurement took place and what was measured. Such events are
            collected in an event log, and, along with the extended PCR values,
            the events can be compared with the expected values representing a
            healthy system.
          </p></dd><dt id="id-1.2.2.3.6"><span class="term">Platform Configuration Register (PCR)</span></dt><dd><p>
            A memory location in TPM that, for example, stores hashes of
            booting layers. PCR can be updated only by using the non-reversible
            operation: <code class="literal">extend</code>. A signed list of current
            PCR values can be obtained by the <code class="command">quote</code> command
            on TPM, and this quote can be verified by a third party during the
            attestation process.
          </p></dd><dt id="id-1.2.2.3.7"><span class="term">Secure boot</span></dt><dd><p>
            Each step of the booting process checks a cryptographic signature
            on the executable of the next step before launching it.
          </p></dd><dt id="id-1.2.2.3.8"><span class="term">Trusted Platform Module (TPM)</span></dt><dd><p>
            A self-contained security cryptographic processor present in the
            system as hardware or implemented in the firmware that serves as a
            root of trust. TPM provides a PCR for storing the hashes of booting
            layers. A typical TPM provides several functions, like a random
            number generator, counters or a local clock. It also stores 24 PCRs
            grouped by banks per each supported cryptographic hash function
            (SHA1, SHA256, SHA384 or SHA512).
          </p><div id="id-1.2.2.3.8.2.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
              By default, TPM usage is disabled. Therefore, the measured boot
              does not take place. To enable the remote attestation, enable TPM
              in the EFI/BIOS menu.
            </p></div></dd><dt id="id-1.2.2.3.9"><span class="term">Secure payload</span></dt><dd><p>
            A mechanism to deliver encrypted data to healthy agents. Payloads
            are used to provide keys, passwords, certificates, configurations
            or scripts that are further used by the agent.
          </p></dd></dl></div></section><section class="sect2" id="keylime-what-is" data-id-title="What is Keylime?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">1.2 </span><span class="title-name">What is Keylime?</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-what-is">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      Keylime is a remote attestation solution that enables you to monitor
      the health of remote nodes using a TPM as a root of trust for
      measurement. With Keylime, you can perform multiple tasks, for example:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Validate of the PCRs extended during the measured boot.
        </p></li><li class="listitem"><p>
          Create analysis and make assertions of the event log.
        </p></li><li class="listitem"><p>
          Make assertion of the value of any PCR in the remote system.
        </p></li><li class="listitem"><p>
          Monitor the validity of open or executed files.
        </p></li><li class="listitem"><p>
          Deliver encrypted data to verified nodes via <span class="emphasis"><em>secure
          payloads</em></span>.
        </p></li><li class="listitem"><p>
          Execute custom scripts that are triggered when a machine fails the
          attested measurements.
        </p></li></ul></div></section><section class="sect2" id="keylime-architecture" data-id-title="Architecture"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">1.3 </span><span class="title-name">Architecture</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-architecture">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      Keylime consists of an agent, a verifier, a registrar and a
      command-line tool (tenant). Agents are on those systems that need to be
      attested. The verifier and registrar are on remote systems that perform
      the registration and attestation of agents. Keep in mind that only the
      agent role is available on <span class="phrase"><span class="phrase">SLE Micro</span></span>. For details about each
      component, refer to the following sections.
    </p><section class="sect3" id="keylime-agent" data-id-title="Keylime agent"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">1.3.1 </span><span class="title-name">Keylime agent</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-agent">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
        The agent is a service that runs on the system that needs to be
        attested. The agent sends the event log, IMA hashes, and information
        about the measured boot to the verifier, using the local TPM as a
        certifier of the data validity.
      </p><p>
        When a new agent is started, it needs to register itself in the
        registrar first. To do so, the agent needs a TLS certificate to
        establish the connection. The TLS certificate is generated by the
        registrar, but it needs to be installed manually to the agent. After
        the registration, the agent sends its attestation key and the public
        part of the endorsement key to the registrar. The registrar responds to
        the agent with a challenge in a process called credential activation,
        which validates the TPM of the agent. Once the agent has been
        registered, it is ready to be enrolled for attestation.
      </p></section><section class="sect3" id="keylime-registrar" data-id-title="Keylime registrar"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">1.3.2 </span><span class="title-name">Keylime registrar</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-registrar">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
        The registrar is used to register agents that should be attested. The
        registrar collects the agent's attestation key, the public part of the
        endorsement key and the endorsement key certification, and verifies
        that the agent attestation key belongs to the endorsement key.
      </p></section><section class="sect3" id="sec-keylime-verifier" data-id-title="Keylime verifier"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">1.3.3 </span><span class="title-name">Keylime verifier</span></span> <a title="Permalink" class="permalink" href="index.html#sec-keylime-verifier">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
        The verifier performs the actual attestation of agents and continuously
        pulls the required attestation data from agents (among others, the
        PCR values, IMA logs, and UEFI event logs).
      </p></section></section></section><section xml:lang="en" class="sect1" id="keylime-run-with-podman" data-id-title="Running the Keylime workload using Podman"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Running the Keylime workload using Podman</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-run-with-podman">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div><div><div class="abstract"><p>
        Keylime is a remote attestation solution that enables you to monitor
        the health of remote nodes. The <span class="emphasis"><em>verifier</em></span> and
        <span class="emphasis"><em>registrar</em></span> are essential components of Keylime on
        remote systems to perform the registration and attestation of Keylime
        agents.
      </p></div></div></div></div><div id="id-1.3.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The container described in this article delivers control plane services
      <span class="emphasis"><em>verifier</em></span> and <span class="emphasis"><em>registrar</em></span> and a
      <span class="emphasis"><em>tenant</em></span> command-line tool (CLI) that are part of the
      Keylime project.
    </p></div><p>
    Before you start installing and registering agents, prepare the verifier
    and the registrar on remote hosts, as described in the following procedure.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Identify the Keylime workload image.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman search keylime
[...]
registry.opensuse.org/devel/microos/containers/containerfile/opensuse/keylime-control-plane</pre></div></li><li class="step"><p>
        Pull the image from the registry.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman pull\
  registry.opensuse.org/devel/microos/containers/containerfile/opensuse/keylime-control-plane:latest</pre></div></li><li class="step"><p>
        Create the <code class="literal">keylime-control-plane</code> volume to
        persist the database and certificates required during the attestation
        process.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman container runlabel install \
  registry.opensuse.org/devel/microos/containers/containerfile/opensuse/keylime-control-plane:latest</pre></div></li><li class="step"><p>
        Start the container and related services.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman container runlabel run \
  registry.opensuse.org/devel/microos/containers/containerfile/opensuse/keylime-control-plane:latest</pre></div><p>
        The <code class="literal">keylime-control-plane</code> container is
        created. It includes configured and running registrar and verifier
        services. Internally, the container exposes ports 8881, 8890 and 8891
        to the host using the default values. Validate the firewall
        configuration to allow access to the ports and to allow communication
        between containers, because the tenant CLI requires it.
      </p></li></ol></div></div><div id="id-1.3.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      If you need to stop Keylime services, run the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">podman kill keylime-control-plane-container</code></pre></div></div><section class="sect2" id="keylime-monitor" data-id-title="Monitoring Keylime services"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.1 </span><span class="title-name">Monitoring Keylime services</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-monitor">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      To get the status of running containers on the host, run the following
      command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman ps</pre></div><p>
      To view the logs of Keylime services, run the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>podman logs keylime-control-plane-container</pre></div></section><section class="sect2" id="keylime-executing-tenant" data-id-title="Executing the tenant CLI"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2 </span><span class="title-name">Executing the tenant CLI</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-executing-tenant">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      The tenant CLI tool is included in the container, and if the host
      firewall does not interfere with the ports exposed by Keylime services,
      you can execute it using the same image, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">podman run --rm \
-v keylime-control-plane-volume:/var/lib/keylime/ \
keylime-control-plane:latest \
keylime_tenant -v 10.88.0.1 -r 10.88.0.1 --cert default -c reglist</code></pre></div></section><section class="sect2" id="keylime-extract-certificates" data-id-title="Extracting the Keylime certificate"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3 </span><span class="title-name">Extracting the Keylime certificate</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-extract-certificates">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      The first time that the Keylime container is executed, its services
      create a certificate required by several agents. You need to extract the
      certificate from the container and copy it to the agent's
      <code class="filename">/var/lib/keylime/cv_ca/</code> directory.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">podman cp \
keylime-control-plane-container:/var/lib/keylime/cv_ca/cacert.crt
.</code>
<code class="prompt root"># </code>scp cacert.crt
<em class="replaceable">AGENT_HOST:/var/lib/keylime/cv_ca/</em></pre></div><div id="id-1.3.8.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
        Find more details about installing the agent in
        <a class="xref" href="index.html#keylime-install-agent" title="3. Installing the Keylime agent">Section 3, “Installing the Keylime agent”</a>.
      </p></div></section></section><section xml:lang="en" class="sect1" id="keylime-install-agent" data-id-title="Installing the Keylime agent"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Installing the Keylime agent</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-install-agent">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div><div><div class="abstract"><p>
        Keylime is a remote attestation solution that enables you to monitor
        the health of remote nodes. The Keylime agent is a service that runs
        on the system that needs to be attested and sends the event log, IMA
        hashes, and information about the measured boot to the verifier.
      </p></div></div></div></div><p>
    The Keylime agent is not present on <span class="phrase"><span class="phrase">SLE Micro</span></span> by default, and you
    need to install it manually. To install the agent, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Install the <span class="package">rust-keylime</span> package as follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>transactional-update pkg in rust-keylime</pre></div><p>
        Then reboot the system.
      </p></li><li class="step"><p>
        Adjust the default agent's configuration.
      </p><ol type="a" class="substeps"><li class="step"><p>
            Create a directory to store a new configuration file for your
            changes in <code class="filename">/etc/keylime/agent.conf.d/</code>. The
            default configuration is stored in
            <code class="filename">/usr/etc/keylime/agent.conf</code>, but we do not
            recommend editing this file because it may be overwritten in upcoming
             system updates.
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mkdir -p /etc/keylime/agent.conf.d</pre></div></li><li class="step"><p>
            Create a new file
            <code class="filename">/etc/keylime/agent.conf.d/agent.conf</code>:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cat &lt;&lt; EOF &gt; /etc/keylime/agent.conf.d/agent.conf
 [agent]
 
 uuid = "d111ec46-34d8-41af-ad56-d560bc97b2e8"<span class="callout" id="co-keylime-agent-uuid">1</span>
 registrar_ip = "<em class="replaceable">&lt;REMOTE_IP&gt;</em>"<span class="callout" id="co-keylime-agent-remoteip1">2</span>
 revocation_notification_ip = "<em class="replaceable">&lt;REMOTE_IP&gt;</em>"<span class="callout" id="co-keylime-agent-remoteip2">3</span>
 EOF</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-keylime-agent-uuid"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
                The unique identifier is generated each time the agent is run.
                However, you can define a specific value by this option.
              </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-keylime-agent-remoteip1"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
                IP address of the registrar.
              </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-keylime-agent-remoteip2"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
                IP address of the verifier.
              </p></td></tr></table></div></li><li class="step"><p>
            Change the owner of the <code class="filename">/etc/keylime/</code>
            directory to <code class="literal">keylime:tss</code>:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chown -R keylime:tss /etc/keylime</pre></div></li><li class="step"><p>
            Change permissions on the <code class="filename">/etc/keylime/</code>
            directory:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chmod -R 600 /etc/keylime</pre></div></li></ol></li><li class="step"><p>
        Copy the certificates generated by the CA to the agent node. On the
        agent node, do the following:
      </p><ol type="a" class="substeps"><li class="step"><p>
            Prepare a directory for the certificate:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mkdir -p /var/lib/keylime/cv_ca</pre></div></li><li class="step"><p>
            Copy the certificate to the agent:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>scp <em class="replaceable">CERT_SERVER_ADDRESS</em>:/var/lib/keylime/cv_ca/cacert.crt /var/lib/keylime/cv_ca</pre></div></li><li class="step"><p>
            Change the owner of the certificate to
            <code class="literal">keylime:tss</code>:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chown -R keylime:tss /var/lib/keylime/cv_ca</pre></div></li></ol></li><li class="step"><p>
        Start and enable the <code class="literal">keylime_agent.service</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl enable --now keylime_agent.service</pre></div></li></ol></div></div></section><section xml:lang="en" class="sect1" id="keylime-register-agent" data-id-title="Registering the Keylime agent"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Registering the Keylime agent</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-register-agent">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div><div><div class="abstract"><p>
        Keylime is a remote attestation solution that enables you to monitor
        the health of remote nodes. The Keylime agent is a service that runs
        on the system that needs to be attested and sends the event log, IMA
        hashes, and information about the measured boot to the verifier.
      </p></div></div></div></div><p>
    You can register a new agent either by using the CLI tenant or by editing
    the configuration of the verifier. Using the tenant on the verifier host,
    run the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>keylime_tenant -v 127.0.0.1 \
  -t <em class="replaceable">AGENT</em> \<span class="callout" id="co-keylime-tenant-agent">1</span>
  -u <em class="replaceable">UUID</em> \<span class="callout" id="co-keylime-tenant-uuid">2</span>
  --cert default \
  -c add
  [--include <em class="replaceable">PATH_TO_ZIP_FILE</em>]<span class="callout" id="co-keylime-tenant-include">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-keylime-tenant-agent"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        <em class="replaceable">AGENT</em> is an IP address of the agent to be
        registered.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-keylime-tenant-uuid"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        <em class="replaceable">UUID</em> is the agent's unique identifier.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-keylime-tenant-include"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The file passed by the <code class="option">include</code> option is used to
        deliver secret payload data to the agent. For details, refer to
        <a class="xref" href="index.html#keylime-payload" title="5. Keylime secure payloads">Section 5, “Keylime secure payloads”</a>.
      </p></td></tr></table></div><p>
    You can list registered agents by using the <code class="command">reglist</code>
    command on the verifier host as follows:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>keylime_tenant -v 127.0.0.1 \
  --cert default \
  -c reglist</pre></div><p>
    To remove a registered agent, specify the agent using the
    <code class="option">-t</code> and <code class="option">-u</code> options and the <code class="option">-c
    delete</code> command as follows:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>keylime_tenant -v 127.0.0.1 \
  -t <em class="replaceable">AGENT</em> \
  -u <em class="replaceable">UUID</em> \
  -c delete</pre></div></section><section xml:lang="en" class="sect1" id="keylime-payload" data-id-title="Keylime secure payloads"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">Keylime secure payloads</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-payload">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div><div><div class="abstract"><p>
        Keylime is a remote attestation solution that enables you to monitor
        the health of remote nodes.
      </p></div></div></div></div><section class="sect2" id="keylime-payload-what-is" data-id-title="What is a secure payload?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.1 </span><span class="title-name">What is a secure payload?</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-payload-what-is">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      A Keylime secure payload enables you to deliver encrypted data to
      healthy agents. Payloads are used to provide keys, passwords,
      certificates, configurations or scripts that are used by the
      Keylime agent at a later stage.
    </p></section><section class="sect2" id="keylime-payload-how-it-works" data-id-title="How does a secure payload work?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2 </span><span class="title-name">How does a secure payload work?</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-payload-how-it-works">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>
      A secure payload is delivered to the agent in a <code class="filename">zip</code>
      file that must contain a shell script named
      <code class="filename">autorun.sh</code>. The script is executed only if the agent
      has been properly registered and verified. To deliver the
      <code class="filename">zip</code> file, use the <code class="option">--include</code> option
      of the <code class="command">keylime_tenant</code> command.
    </p><p>
      For example, the following <code class="filename">autorun.sh</code> script creates
      a directory structure and copies SSH keys there. The related
      <code class="filename">zip</code> archive must include these SSH keys.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat autorun.sh
#!/bin/bash
 
 mkdir -p /root/.ssh/
 cp id_rsa* /root/.ssh/
 chmod 600 /root/.ssh/id_rsa*
 cp /root/.ssh/id_rsa.pub /root/.ssh/authorized_keys</pre></div></section></section><section xml:lang="en" class="sect1" id="keylime-enable-ima-tracking" data-id-title="Enabling IMA tracking for Keylime"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Enabling IMA tracking for Keylime</span></span> <a title="Permalink" class="permalink" href="index.html#keylime-enable-ima-tracking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div><div><div class="abstract"><p>
        Keylime is a remote attestation solution that enables you to monitor
        the health of remote nodes. <span class="emphasis"><em>Integrity management
        architecture</em></span> (IMA) is a kernel integrity subsystem that
        provides a means of detecting malicious changes to files.
      </p></div></div></div></div><p>
    When using IMA, the kernel calculates a hash of accessed files. The hash is
    then used to extend the PCR 10 in the TPM and also log a list of accessed
    files. The verifier can request a signed quote to the agent for PCR 10 to
    get the logs of all accessed files including the file hashes. Verifiers
    then compare the accessed files with a local allowlist of approved files.
    If any of the hashes are not recognized, the system is considered unsafe,
    and a revocation event is triggered.
  </p><p>
    Before Keylime can collect information, IMA/EVM needs to be enabled. To
    enable the process, boot a kernel of the agent with the
    <code class="literal">ima_appraise=log</code> and <code class="literal">ima_policy=tcb</code>
    parameters:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Update the <code class="option">GRUB_CMDLINE_LINUX_DEFAULT</code> option with the
        parameters in <code class="filename">/etc/default/grub</code>:
      </p><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_LINUX_DEFAULT="ima_appraise=log ima_policy=tcb"</pre></div></li><li class="step"><p>
        Regenerate <code class="filename">grub.cfg</code> by running:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>transactional-update grub.cfg</pre></div></li><li class="step"><p>
        Reboot your system.
      </p></li></ol></div></div><p>
    The procedure above uses the default kernel IMA policy. To avoid monitoring
    too many files and therefore creating long logs, create a new custom
    policy. Find more details in the
    <a class="link" href="https://keylime-docs.readthedocs.io/en/latest/user_guide/runtime_ima.html" target="_blank">Keylime
    documentation</a>.
  </p><p>
    To indicate the expected hashes, use the <code class="option">--allowlist</code>option
    of the <code class="command">keylime_tenant</code> command when registering the
    agent. To view the excluded or ignored files, use the
    <code class="option">--exclude</code> option of the <code class="command">keylime_tenant</code>
    command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>keylime_tenant --allowlist
    -v 127.0.0.1 \
    -u <em class="replaceable">UUID</em></pre></div></section><section xml:lang="en" class="sect1" id="cockpit-more-info" data-id-title="For more information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7 </span><span class="title-name">For more information</span></span> <a title="Permalink" class="permalink" href="index.html#cockpit-more-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        Keylime home page is at <a class="link" href="https://keylime.dev" target="_blank">https://keylime.dev</a>.
      </p></li><li class="listitem"><p>
        Latest Keylime documentation is at
        <a class="link" href="https://keylime.readthedocs.io/en/latest/" target="_blank">https://keylime.readthedocs.io/en/latest/</a>.
      </p></li><li class="listitem"><p>
        For a high-level overview of IMA/EVM, refer to
        <a class="link" href="https://en.opensuse.org/SDB:Ima_evm#Introduction" target="_blank">https://en.opensuse.org/SDB:Ima_evm#Introduction</a>.
      </p></li><li class="listitem"><p>
        Find more details about creating a new kernel IMA policy in
        <a class="link" href="https://keylime-docs.readthedocs.io/en/latest/user_guide/runtime_ima.html" target="_blank">https://keylime-docs.readthedocs.io/en/latest/user_guide/runtime_ima.html</a>.
      </p></li></ul></div></section><section class="sect1" id="legal-disclaimer" data-id-title="Legal Notice"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name">Legal Notice</span></span> <a title="Permalink" class="permalink" href="index.html#legal-disclaimer">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p> Copyright© 2006–2024
 SUSE LLC and contributors.
  All rights reserved. </p><p>
    Permission is granted to copy, distribute and/or modify this document under the terms of the
    GNU Free Documentation License, Version 1.2 or (at your option) version 1.3; with the Invariant
    Section being this copyright notice and license. A copy of the license version 1.2 is included
    in the section entitled <span class="quote">“<span class="quote">GNU Free Documentation License</span>”</span>.
  </p><p>
    For SUSE trademarks, see <a class="link" href="https://www.suse.com/company/legal/" target="_blank">https://www.suse.com/company/legal/</a>. All other
    third-party trademarks are the property of their respective owners. Trademark symbols (®, ™
    etc.) denote trademarks of SUSE and its affiliates. Asterisks (*) denote third-party
    trademarks.
  </p><p>
    All information found in this book has been compiled with utmost attention to detail. However,
    this does not guarantee complete accuracy.  Neither SUSE LLC, its affiliates, the authors, nor
    the translators shall be held liable for possible errors or the consequences thereof.
  </p></section></section><nav class="bottom-pagination"><div> </div><div><a class="pagination-link next" href="doc-gfdl-license.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Appendix A </span>GNU Free Documentation License</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="index.html#keylime-remote-attestation"><span class="title-number">1 </span><span class="title-name">Remote attestation using Keylime</span></a></span></li><li><span class="section"><a href="index.html#keylime-run-with-podman"><span class="title-number">2 </span><span class="title-name">Running the Keylime workload using Podman</span></a></span></li><li><span class="section"><a href="index.html#keylime-install-agent"><span class="title-number">3 </span><span class="title-name">Installing the Keylime agent</span></a></span></li><li><span class="section"><a href="index.html#keylime-register-agent"><span class="title-number">4 </span><span class="title-name">Registering the Keylime agent</span></a></span></li><li><span class="section"><a href="index.html#keylime-payload"><span class="title-number">5 </span><span class="title-name">Keylime secure payloads</span></a></span></li><li><span class="section"><a href="index.html#keylime-enable-ima-tracking"><span class="title-number">6 </span><span class="title-name">Enabling IMA tracking for Keylime</span></a></span></li><li><span class="section"><a href="index.html#cockpit-more-info"><span class="title-number">7 </span><span class="title-name">For more information</span></a></span></li><li><span class="section"><a href="index.html#legal-disclaimer"><span class="title-number">8 </span><span class="title-name">Legal Notice</span></a></span></li><li><span class="appendix"><a href="doc-gfdl-license.html"><span class="title-number">A </span><span class="title-name">GNU Free Documentation License</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>